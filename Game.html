<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dino Jump â€” PoketGames.com</title>
  <style>
    :root {
      --bg: #f7f7f7;
      --ground: #555;
      --dino: #2b8a3e;
      --ob: #2f2f2f;
      --accent: #ffcc00;
    }
    html,body {
      height:100%;
      margin:0;
      font-family: Inter, system-ui, Arial, sans-serif;
      background: linear-gradient(#e9f2ff, var(--bg));
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .wrap {
      width:100%;
      max-width:1200px;
      padding:18px;
      box-sizing:border-box;
    }
    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
      flex-wrap:wrap;
      gap:10px;
    }
    header h1 { font-size:20px; margin:0; color:#333; }
    .username { font-weight:700; color:#007700; }
    .score { font-weight:700; color:#333; }

    .game-box {
      background:#fff;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(10,20,30,0.08);
      overflow:hidden;
      position:relative;
    }
    canvas {
      display:block;
      width:100%;
      height:auto;
      touch-action: none; /* ðŸŸ¢ Tambahan agar tap tak scroll layar */
    }

    .hud {
      position:absolute;
      top:12px;
      left:12px;
      right:12px;
      display:flex;
      justify-content:space-between;
      pointer-events:none;
    }
    .hud .left, .hud .right { pointer-events:auto; }
    .btn {
      background:var(--accent);
      border:none;
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      transition:0.2s;
    }
    .btn:hover { filter:brightness(0.9); }

    .overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      background:linear-gradient(rgba(255,255,255,0.7),rgba(255,255,255,0.3));
      backdrop-filter:blur(3px);
    }
    .overlay.hidden { display:none; }
    .overlay h2 { margin:0 0 8px 0; }
    .overlay p { margin:0 0 16px 0; color:#444; }
    .small { font-size:13px; color:#666; }

    @media (max-width:480px){
      header h1{font-size:16px}
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>PoketGames â€” Dino Jump</h1>
    <div class="username">ðŸ‘¤ <span id="username"></span></div>
    <div class="score">Best: <span id="best">0</span></div>
  </header>

  <div class="game-box">
    <canvas id="gameCanvas" width="1200" height="250"></canvas>

    <div class="hud">
      <div class="left">
        <button id="btnRestart" class="btn">Restart</button>
      </div>
      <div class="right">
        <div class="score">Score: <span id="score">0</span></div>
      </div>
    </div>

    <div id="overlay" class="overlay">
      <h2>Tekan spasi atau tap untuk lompat</h2>
      <p class="small">Hindari rintangan dan raih skor tertinggi!</p>
      <button id="startBtn" class="btn">Mulai</button>
      <button id="backBtn" class="btn" style="margin-top:10px; background:#ff6666;">Kembali</button>
    </div>
  </div>
</div>

<script>
// === Ambil username dari localStorage ===
const username = localStorage.getItem('username') || 'Player';
document.getElementById('username').textContent = username;

// === Canvas setup ===
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const W = 1200, H = 250;
canvas.width = W; canvas.height = H;

function fitCanvas(){
  const box = canvas.parentElement.clientWidth;
  const scale = Math.min(1, box / W);
  canvas.style.width = Math.floor(W * scale) + 'px';
}
window.addEventListener('resize', fitCanvas);
fitCanvas();

// === Game state ===
let gameRunning = false;
let score = 0;
let best = Number(localStorage.getItem('dino_best') || 0);
document.getElementById('best').textContent = best;

// === Dino ===
const dino = {x:50,y:H-52,w:40,h:40,dy:0,gravity:0.9,jumpPower:-15,grounded:true};
const groundY = H - 30;

// === Obstacles ===
let obstacles = [];
let spawnTimer = 0;

// === Controls ===
function jump(){
  if (!gameRunning) startGame();
  if (dino.grounded){
    dino.dy = dino.jumpPower;
    dino.grounded = false;
  }
}

// ðŸŸ¢ Tambahan: kontrol keyboard dan layar sentuh
document.addEventListener('keydown', (e)=>{
  if (e.code === 'Space' || e.code === 'ArrowUp'){
    e.preventDefault();
    jump();
  }
});
canvas.addEventListener('pointerdown', jump);

// === Start & End ===
function startGame(){
  gameRunning = true;
  score = 0;
  obstacles = [];
  spawnTimer = 0;
  dino.y = H - 52; dino.dy = 0; dino.grounded = true;
  overlay.classList.add('hidden');
  lastTime = performance.now();
  requestAnimationFrame(loop);
}

function endGame(){
  gameRunning = false;
  overlay.classList.remove('hidden');
  overlay.querySelector('h2').textContent = 'Game Over';
  overlay.querySelector('.small').textContent = `Skor kamu: ${score}`;
  if (score > best){
    best = score;
    localStorage.setItem('dino_best', best);
    document.getElementById('best').textContent = best;
  }
}

// === Obstacle ===
function spawnObstacle(){
  const h = 20 + Math.random() * 35;
  const obs = {x:W+10,y:groundY-h,w:h,h:h,speed:6+Math.random()*2};
  obstacles.push(obs);
}

// === Loop ===
let lastTime = 0;
function loop(timestamp){
  const dt = (timestamp - lastTime) / 16.666;
  lastTime = timestamp;
  update(dt);
  draw();
  if (gameRunning) requestAnimationFrame(loop);
}

function update(dt){
  dino.dy += dino.gravity * dt * 0.9;
  dino.y += dino.dy * dt;
  if (dino.y + dino.h >= groundY){
    dino.y = groundY - dino.h;
    dino.dy = 0;
    dino.grounded = true;
  }

  spawnTimer -= dt;
  if (spawnTimer <= 0){
    spawnObstacle();
    spawnTimer = 60 + Math.random()*80;
  }

  for (let i = obstacles.length-1; i>=0; i--){
    const o = obstacles[i];
    o.x -= o.speed * dt;
    if (o.x + o.w < 0){ obstacles.splice(i,1); score++; document.getElementById('score').textContent = score; }
    if (rectsIntersect(dino,o)){ endGame(); }
  }
}

function rectsIntersect(a,b){
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function draw(){
  ctx.clearRect(0,0,W,H);
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#e9f2ff'); g.addColorStop(1,'#ffffff');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  ctx.fillStyle = 'rgba(0,0,0,0.08)'; ctx.fillRect(0,groundY,W,H);
  ctx.fillStyle = 'var(--ground,#555)'; ctx.fillRect(0,groundY,W,4);

  ctx.fillStyle = 'var(--dino)'; ctx.fillRect(dino.x, Math.round(dino.y), dino.w, dino.h);
  ctx.fillStyle = '#111'; ctx.fillRect(dino.x + dino.w - 10, Math.round(dino.y) + 10, 6, 6);

  ctx.fillStyle = 'var(--ob)';
  obstacles.forEach(o => ctx.fillRect(Math.round(o.x), Math.round(o.y), o.w, o.h));
}

// === Buttons & Overlay ===
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const backBtn = document.getElementById('backBtn');
const btnRestart = document.getElementById('btnRestart');

startBtn.addEventListener('click', startGame);
btnRestart.addEventListener('click', ()=>{ if (!gameRunning) startGame(); else location.reload(); });

// ðŸ”¹ Tombol kembali â€” hapus data & redirect
backBtn.addEventListener('click', ()=>{
  localStorage.removeItem('username');
  localStorage.removeItem('dino_best');
  localStorage.removeItem('score');
  window.location.href = 'index.html';
});

// === Initial Draw ===
draw();
</script>
</body>
</html>

